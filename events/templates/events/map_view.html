{% extends "base.html" %}
{% load static %}

{% block extra_js %}
<script>
// Make a variable of an empty array and loop through the data to make a javascript object of event name, event discipline, event latitude, event longitude

$( document ).ready(function() {
    console.log( "ready!" );
var mapevents = [
    {% for event in events %}

{{ event.latitude }},
{{ event.longitude }},

{% endfor %}
];

console.log (mapevents)
});
</script>
{% endblock %}

{% block page_header %}
    <div class="container header-container">
        <div class="row">
            <div class="col"></div>
        </div>
    </div>
{% endblock %}



{% block content %}
    <div class="container-fluid">
        <div class="row">
            <div class="col-12 ">
             <h1>Map View</h1>
             <div id="mapid" class="map-large-size"></div>
            </div>
        </div>
    </div>
{% endblock %}

<!-- References:

https://codepen.io/bbrook154/pen/RRQQyG

https://leafletjs.com/examples/quick-start/
-->
{% block postloadjs %}
    {{ block.super }}
<script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="https://d3js.org/topojson.v0.min.js"></script>
	<link rel="stylesheet" href="https://npmcdn.com/leaflet@1.0.0-rc.2/dist/leaflet.css" />
	 <script src="https://npmcdn.com/leaflet@1.0.0-rc.2/dist/leaflet.js"></script>


<script>
navigator.geolocation.getCurrentPosition(function(location) {
  var latlng = new L.LatLng(location.coords.latitude, location.coords.longitude);

  var mymap = L.map('mapid').setView(latlng, 8)
  L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
            maxZoom: 18
         }).addTo(mymap);

var marker = L.marker(latlng).addTo(mymap);
{% for event in events %}
var marker = L.marker([{{ event.latitude }}, {{ event.longitude }}]).addTo(mymap); 
marker.bindPopup(`<b>{{ event.name }}</b><br><img src='/media/walking.svg' width='20px'>{{ event.discipline }} | 
<A href='{% url 'event_profile' event.id %}'>View</a>`).openPopup();  

{% endfor %}  
// var marker = L.marker([51.5, -0.09]).addTo(mymap);  
  
// marker.bindPopup("<b>Hello world!</b><br>I am a popup.").openPopup();  
  
// var marker = L.marker([51.9, -0.12]).addTo(mymap);    
  
// marker.bindPopup("<b>Hello world!</b><br>I am another popup.").openPopup(); 
  
// var marker = L.marker([53.56588, -1.69692]).addTo(mymap);   

});
</script>
{% endblock %}